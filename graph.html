<!DOCTYPE html>
<html lang="en">

<head>
    <title>Graph Theory</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link href="graph.css" rel="stylesheet">
    <style>
        canvas {
            background-color: rgb(0, 176, 240);
            font-size: 14pt;
            color: white;
        }
    </style>
</head>

<body>
    <canvas id="cv" width="1200" height="400"></canvas>
    <script>
        var effacer = (cv) => cv.getContext("2d").clearRect(0, 0, cv.width, cv.height)
        var draw_vertex = (pts, ctx) => {
            //console.log("PTS="+pts);        
            pts.forEach(([x, y, color]) => {
                ctx.fillStyle = color;
                ctx.beginPath();
                //ctx.rect(x - 2, y - 2, 4, 4);
                ctx.arc(x - 2, y - 2, 4, 0, Math.PI * 2, true);
                ctx.fill();
            })
        }


        var draw_edge = (edges, ctx) => {
            edges.forEach(([x, y, z, t]) => {
                ctx.beginPath()
                ctx.strokeStyle = "white"
                ctx.lineWidth=5;
                ctx.moveTo(x, y)
                ctx.lineTo(z, t)
                ctx.stroke()
            })

        }

        var dist = (A, B) => (A[0] - B[0]) * (A[0] - B[0]) + (A[1] - B[1]) * (A[1] - B[1]);
        var obj = ({
            init() {
                console.log("Initialisation");

                [cv].forEach(e => e.addEventListener('click', this))
            },
            index: 0,
            ctx: cv.getContext("2d"),
            rect: cv.getBoundingClientRect(),
            edges: [],
            vertex: [],
            handleEvent(e) {
                let actual = [e.clientX - this.rect.left, e.clientY - this.rect.top, "black"];
                let tab = this.vertex.filter(e => dist(actual, e) < 100);
                if (tab.length > 0) {
                    console.log("Find " + tab[0]);
                    let ind = this.vertex.indexOf(tab[0]);
                    // Savoir si déjà une selection 
                    let selec = this.vertex.filter(e => e[2] === "red");
                    if (selec.length > 0) {
                        console.log("Already selected");
                        let ind2 = this.vertex.indexOf(selec[0]);
                        this.vertex.forEach(e => e[2] = "black");
                        let edge = [this.vertex[ind2][0], this.vertex[ind2][1], this.vertex[ind][0], this.vertex[ind][1]];
                        this.edges.push(edge);
                    }
                    else {
                        console.log("First selected");
                        this.vertex[ind][2] = "red";
                    }

                }
                else {
                    this.index++;
                    this.vertex.push(actual);
                }
                effacer(cv);        
                draw_edge(this.edges,this.ctx);
                draw_vertex(this.vertex, this.ctx);
            },
        }).init();
    </script>

</body>

</html>